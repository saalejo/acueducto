import{u as V,a as D,b as H,c as G,d as J,Q as K,i as U,e as W,f as Z,g as L,h as z,j as A}from"./messages.e4dc68a2.js";import{c as S,k as X,r as d,w as Y,n as ee,h as v,$ as te,l as ae,_ as ie,G as O,ag as ne,o as oe,H as C,I as $,K as E,d as h,Q as le,J as _,N as T,ah as re,F as se,ai as ue,L as ce,O as j,aj as M,Z as de,ak as fe}from"./index.28ee533b.js";import{u as ge}from"./configuracion-store.41024054.js";import{api as F}from"./axios.0663647d.js";import"./use-dark.7c6f1a77.js";const me={ratio:[String,Number]};function ve(e,r){return S(()=>{const m=Number(e.ratio||(r!==void 0?r.value:void 0));return isNaN(m)!==!0&&m>0?{paddingBottom:`${100/m}%`}:null})}const he=16/9;var Se=X({name:"QImg",props:{...me,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:he},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:r,emit:m}){const w=d(e.initialRatio),b=ve(e,w);let i=null,y=!1;const f=[d(null),d(o())],s=d(0),l=d(!1),g=d(!1),R=S(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),q=S(()=>({width:e.width,height:e.height})),Q=S(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),B=S(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));Y(()=>a(),n);function a(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function o(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function n(t){i!==null&&(clearTimeout(i),i=null),g.value=!1,t===null?(l.value=!1,f[s.value^1].value=o()):l.value=!0,f[s.value].value=t}function u({target:t}){y!==!0&&(i!==null&&(clearTimeout(i),i=null),w.value=t.naturalHeight===0?.5:t.naturalWidth/t.naturalHeight,c(t,1))}function c(t,x){y===!0||x===1e3||(t.complete===!0?p(t):i=setTimeout(()=>{i=null,c(t,x+1)},50))}function p(t){y!==!0&&(s.value=s.value^1,f[s.value].value=null,l.value=!1,g.value=!1,m("load",t.currentSrc||t.src))}function k(t){i!==null&&(clearTimeout(i),i=null),l.value=!1,g.value=!0,f[s.value].value=null,f[s.value^1].value=o(),m("error",t)}function I(t){const x=f[t].value,N={key:"img_"+t,class:Q.value,style:B.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...x};return s.value===t?(N.class+=" q-img__image--waiting",Object.assign(N,{onLoad:u,onError:k})):N.class+=" q-img__image--loaded",v("div",{class:"q-img__container absolute-full",key:"img"+t},v("img",N))}function P(){return l.value!==!0?v("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ae(r[g.value===!0?"error":"default"])):v("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},r.loading!==void 0?r.loading():e.noSpinner===!0?void 0:[v(ie,{color:e.spinnerColor,size:e.spinnerSize})])}return n(a()),ee(()=>{y=!0,i!==null&&(clearTimeout(i),i=null)}),()=>{const t=[];return b.value!==null&&t.push(v("div",{key:"filler",style:b.value})),g.value!==!0&&(f[0].value!==null&&t.push(I(0)),f[1].value!==null&&t.push(I(1))),t.push(v(te,{name:"q-transition--fade"},P)),v("div",{class:R.value,style:q.value,role:"img","aria-label":e.alt},t)}}});const _e={class:"col q-pa-md"},ye={class:"row fixed-bottom-right"},be={class:"col q-pa-md"},ke=O({__name:"RutasComponent",setup(e){const r=V(),m=ne(),w=ge(),b=D(),i=H(),y=G(),f=J(),s=d(S(()=>w.obtener)),l=d(S(()=>i.obtener));d(S(()=>b.obtener));const g=d([]),R=a=>{if(a.rutaStore){const o=a.rutaStore.next?a.rutaStore.next:a.rutaStore.lecturas[0],n=a.rutaStore.lecturas.find(u=>u.id==o.id);b.modificar(a.rutaStore),f.modificar(n),a.rutaStore.selected=!0,a.rutaStore.lecturas.forEach(u=>{g.value.includes(u.consumo.sector)||(g.value=g.value.concat([u.consumo.sector]))}),y.modificar(g.value),m.push({path:"/ruta"})}},q=(a,o)=>{r.loading.show();const n="/rutas/"+a.id;F.get(n).then(u=>{const c=u.data;a.rutaStore=c,i.modificar(l.value),o&&R(a)}).catch(()=>{r.notify(W)}).finally(()=>{r.loading.hide()})},Q=()=>{if(s.value.token){r.loading.show();const a="/ruta_simple/?dispositivo__codigo="+s.value.token;F.get(a).then(o=>{const n=o.data,u=d([]);l.value.forEach(c=>{n.find(k=>k.id==c.id)||l.value.splice(l.value.indexOf(c),1)}),n.forEach(c=>{l.value.find(k=>k.id==c.id)||(u.value=u.value.concat([c]),q(c,!1))}),i.modificar(u.value.concat(l.value))}).catch(o=>{r.notify(U)}).finally(()=>{r.loading.hide()})}},B=a=>{const o=l.value.find(n=>n.id==a.id);l.value.forEach(n=>n.selected==!1),o.selected=!0,o.rutaStore?R(o):q(o,!0)};return oe(Q),(a,o)=>(C(),$("div",_e,[E("div",ye,[E("div",be,[h(le,{onClick:Q,icon:"refresh",round:"",color:"primary"})])]),h(K,{bordered:"",separator:""},{default:_(()=>[(C(!0),$(se,null,ue(l.value,n=>ce((C(),T(Z,{clickable:"",key:n.id,onClick:u=>B(n)},{default:_(()=>[h(L,null,{default:_(()=>[h(z,null,{default:_(()=>[j(M(n.vereda),1)]),_:2},1024),h(z,{caption:""},{default:_(()=>[j(M(n.fecha),1)]),_:2},1024)]),_:2},1024),h(L,{side:""},{default:_(()=>[h(de,{name:"done"})]),_:1})]),_:2},1032,["onClick"])),[[fe]])),128))]),_:1}),s.value.api_uri?(C(),T(Se,{key:0,"no-spinner":"",src:s.value.api_uri+"/static/img/logo.png"},null,8,["src"])):re("",!0)]))}}),xe=O({__name:"RutasPage",setup(e){return(r,m)=>(C(),T(A,{class:"row"},{default:_(()=>[h(ke)]),_:1}))}});export{xe as default};
